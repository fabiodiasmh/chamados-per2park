import{Q,a as q}from"./QBanner-Da240Ycf.js";import{V as B,r as g,a as L,o as z,T as I,X as i,Y as a,Z as c,$ as o,a3 as m,a4 as _,a6 as u,_ as h,a2 as R,a0 as S,a7 as v,ap as j,aq as D,ah as N,ai as P}from"./index-BE8DfBw_.js";import{Q as T}from"./QPage-Behg0GmU.js";import{u as V}from"./use-quasar-Bbj5Ecy2.js";import{u as E}from"./chamados-OtdS_G61.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./auth-BxROLjNn.js";const A={class:"container"},F={class:"header-section"},M={class:"text-subtitle2 text-grey-3"},$={key:0,class:"loading-container flex flex-center"},H={key:2,class:"empty-state text-center q-pa-xl"},O={key:3,class:"ranking-list"},X={class:"position-container flex flex-center"},Y={key:3,class:"position-number text-white text-weight-bold"},Z={class:"details flex column justify-center q-pl-md q-pt-sm"},G={class:"text-subtitle2 text-white text-weight-medium"},J={class:"text-h6 text-white q-mt-xs"},K={__name:"RelatoriosPage",setup(W){const k=B(),C=E();V();const r=g([]),d=g(!0),l=g(null),y=g("");let p=null;const w=L(()=>[...r.value].sort((t,e)=>{const s=t.totalChamados||t.chamados||0;return(e.totalChamados||e.chamados||0)-s})),f=t=>{const e=Object.entries(t);if(e.length===0)return{nome:"Desconhecido",totalChamados:0};const[s,n]=e[0];return{nome:s,totalChamados:n}},x=async()=>{d.value=!0,l.value=null;try{const t=await C.fetchTopLocais();if(!t.success)throw new Error(t.message||"Falha ao carregar ranking de locais");r.value=t.data||[],y.value=new Date().toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch(t){l.value=t.message||"Erro desconhecido"}finally{d.value=!1}},b=t=>{const e=f(t);if(!e.nome||e.nome==="Desconhecido")return;const s=encodeURIComponent(e.nome);k.push({path:"/chamados",query:{local:s}})};return z(()=>{x(),p=setInterval(x,18e4)}),I(()=>{p&&clearInterval(p)}),(t,e)=>(a(),i(T,{class:"dashboard-page"},{default:c(()=>[o("div",A,[o("div",F,[e[0]||(e[0]=o("div",{class:"text-h6 text-weight-bold text-white"}," Ranking de Unidades com Mais Chamados Abertos ",-1)),o("div",M," Atualizado em: "+u(y.value),1)]),d.value?(a(),m("div",$,[h(Q,{color:"primary",size:"3em"}),e[1]||(e[1]=o("div",{class:"q-mt-md text-subtitle1 text-grey-7"},"Carregando dados...",-1))])):_("",!0),l.value?(a(),i(q,{key:1,class:"bg-negative text-white q-mb-lg"},{avatar:c(()=>[h(v,{name:"error",color:"white"})]),action:c(()=>[h(S,{flat:"",color:"white",label:"Tentar novamente",onClick:x})]),default:c(()=>[R(" Falha ao carregar os dados: "+u(l.value)+" ",1)]),_:1})):_("",!0),!d.value&&!l.value&&(!r.value||r.value.length===0)?(a(),m("div",H,[h(v,{name:"inbox",size:"5em",color:"grey-5"}),e[2]||(e[2]=o("div",{class:"text-h6 text-grey-5 q-mt-md"},"Nenhum dado disponÃ­vel",-1))])):_("",!0),!d.value&&!l.value&&r.value&&r.value.length>0?(a(),m("div",O,[(a(!0),m(j,null,D(w.value.slice(0,10),(s,n)=>(a(),i(N,{key:n,class:"ranking-item",onClick:ee=>b(s)},{default:c(()=>[h(P,{class:"ranking-content flex items-center"},{default:c(()=>[o("div",X,[n===0?(a(),i(v,{key:0,name:"emoji_events",size:"1.5em",color:"yellow"})):n===1?(a(),i(v,{key:1,name:"emoji_events",size:"1.5em",color:"grey"})):n===2?(a(),i(v,{key:2,name:"emoji_events",size:"1.5em",color:"orange"})):(a(),m("div",Y,u(n+1),1))]),o("div",Z,[o("div",G,u(f(s).nome),1),o("div",J,u(f(s).totalChamados)+" chamados ",1)])]),_:2},1024)]),_:2},1032,["onClick"]))),128))])):_("",!0)])]),_:1}))}},ie=U(K,[["__scopeId","data-v-d9e69603"]]);export{ie as default};
