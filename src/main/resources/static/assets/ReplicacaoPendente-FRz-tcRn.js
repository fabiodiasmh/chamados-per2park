import{Q as $,a as I}from"./QBanner-Da240Ycf.js";import{r as p,a as Q,o as T,T as z,X as b,Y as o,Z as n,$ as s,a3 as m,a4 as f,a6 as l,_ as i,a2 as w,a0 as Y,a7 as C,ap as E,aq as O,ah as V,ar as F,ai as H}from"./index-BE8DfBw_.js";import{u as A,Q as L,a as j,d as X}from"./monitoramentoServidor-BYf4WHC2.js";import{Q as Z}from"./QPage-Behg0GmU.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QList-CZg0gtky.js";import"./QSelect-q0SGygbP.js";import"./QItem-BKzL62VN.js";import"./format-DqjPHcII.js";import"./auth-BxROLjNn.js";const J={class:"container"},K={class:"header-section"},W={class:"text-subtitle3 text-grey-3"},ee={key:0,class:"loading-container flex flex-center"},te={key:2,class:"empty-state text-center q-pa-xl"},ae={key:3,class:"ranking-list"},se={class:"details flex column justify-between q-pl-xs",style:{"min-height":"100px"}},oe={class:"text-subtitle1 text-black text-weight-medium"},ne={class:"text-caption text-black"},le={class:"q-mt-xs"},re={class:"text-h6 text-red-10"},ie={class:"q-mt-md tabela"},de={key:0,class:"text-red text-caption"},ce={__name:"ReplicacaoPendente",setup(ue){const M=A(),r=p([]),c=p(!0),d=p(null),y=p("");let v=null;const U=[{name:"ClientName",label:"Cliente",field:"ClientName",align:"left",sortable:!0},{name:"Name",label:"Unidade",field:"Name",align:"left",sortable:!0},{name:"UploadDate",label:"Data Ultimo Upload",field:"UploadDate",align:"left",sortable:!0}],D=e=>X.formatDate(e,"DD/MM/YYYY HH:mm:ss"),N=e=>{const t=new Date,a=new Date(e),u=t-a;return Math.floor(u/6e4)},P=e=>N(e)>1,q=e=>{if(!e)return"-";const t=new Date,a=new Date(e),u=t-a,h=Math.floor(u/6e4),k=Math.floor(h/1440),_=Math.floor(h%1440/60),x=h%60;return k>0?`${k}d ${_}h ${x}min`:_>0?`${_}h ${x}min`:`${x} min`},R=(e,t)=>e>0?"bg-orange-4":t>0?"bg-light-blue-1":"bg-green-9",S=Q(()=>r.value.filter(e=>{var t;return((t=e.ReplicationQueue)==null?void 0:t.Pendencies)>10})),B=Q(()=>{const e=new Date;return e.setMinutes(e.getMinutes()-10),r.value.filter(t=>t.Status!==0?!1:new Date(t.UploadDate)<e)}),g=async()=>{c.value=!0,d.value=null;try{const e=await M.fetchReplicacao();if(!e.success)throw new Error(e.message||"Falha ao carregar dados de replicação");r.value=e.data||[],y.value=new Date().toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch(e){d.value=e.message||"Erro desconhecido ao buscar replicação"}finally{c.value=!1}};return T(()=>{g(),v=setInterval(()=>{g()},18e4),setInterval(()=>{},6e4)}),z(()=>{v&&clearInterval(v)}),(e,t)=>(o(),b(Z,{class:"dashboard-page"},{default:n(()=>[s("div",J,[s("div",K,[t[0]||(t[0]=s("div",{class:"text-h6 text-weight-bold text-white"}," Pendências de Replicação ",-1)),s("div",W," Atualizado em: "+l(y.value),1)]),c.value?(o(),m("div",ee,[i($,{color:"primary",size:"3em"}),t[1]||(t[1]=s("div",{class:"q-mt-md text-subtitle1 text-grey-7"},"Carregando dados...",-1))])):f("",!0),d.value?(o(),b(I,{key:1,class:"bg-negative text-white q-mb-lg"},{avatar:n(()=>[i(C,{name:"error",color:"white"})]),action:n(()=>[i(Y,{flat:"",color:"white",label:"Tentar novamente",onClick:g})]),default:n(()=>[w(" Falha ao carregar os dados: "+l(d.value)+" ",1)]),_:1})):f("",!0),!c.value&&!d.value&&(!r.value||r.value.length===0)?(o(),m("div",te,[i(C,{name:"sync_problem",size:"5em",color:"grey-5"}),t[2]||(t[2]=s("div",{class:"text-h6 text-grey-5 q-mt-md"},"Nenhuma pendência encontrada",-1))])):f("",!0),!c.value&&!d.value&&r.value&&r.value.length>0?(o(),m("div",ae,[(o(!0),m(E,null,O(S.value,(a,u)=>(o(),b(V,{key:u,class:F(["ranking-item",R(a.ReplicationQueue.error,a.ReplicationQueue.Pendencies)])},{default:n(()=>[i(H,{class:"ranking-content"},{default:n(()=>[s("div",se,[s("div",oe,l(a.ClientName)+" — "+l(a.Name),1),s("div",ne," Upload: "+l(D(a.UploadDate)),1),s("div",le,[s("div",re,[t[3]||(t[3]=s("strong",null,"Pendente:",-1)),w(" "+l(a.ReplicationQueue.Pendencies),1)])])])]),_:2},1024)]),_:2},1032,["class"]))),128))])):f("",!0),s("div",ie,[i(L,{title:"Servidores Offline",rows:B.value,columns:U,"row-key":"id",pagination:{rowsPerPage:30},bordered:"",dense:"",flat:"","no-data-label":"Nenhum servidor offline encontrado.","no-results-label":"Nenhum resultado encontrado.",class:"q-mt-md","card-style":"backgroundColor: ;"},{"body-cell-UploadDate":n(a=>[i(j,{props:a},{default:n(()=>[s("div",null,[w(l(D(a.row.UploadDate))+" ",1),P(a.row.UploadDate)?(o(),m("div",de," Offline há "+l(q(a.row.UploadDate)),1)):f("",!0)])]),_:2},1032,["props"])]),_:1},8,["rows"])])])]),_:1}))}},ye=G(ce,[["__scopeId","data-v-5cd10856"]]);export{ye as default};
